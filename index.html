<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDN æ·±åº¦æ¢æµ‹å™¨</title>
    <style>
        :root {
            --bg-color: #0d1117;
            --panel-bg: #161b22;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --border-color: #30363d;
            --accent-color: #58a6ff;
            --success-color: #238636;
            --warning-color: #d29922;
            --danger-color: #f85149;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 { border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-bottom: 30px; }

        /* è¾“å…¥åŒºåŸŸæ ·å¼ */
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 16px;
            min-width: 200px;
        }

        button {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: opacity 0.2s;
        }
        button:hover { opacity: 0.9; }
        button:disabled { background-color: var(--border-color); cursor: not-allowed; }

        .options {
            margin-bottom: 20px;
            color: var(--text-secondary);
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ç»“æœå¡ç‰‡ */
        .card {
            background-color: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .cdn-badge {
            display: inline-flex;
            align-items: center;
            background-color: rgba(56, 139, 253, 0.15);
            color: #58a6ff;
            border: 1px solid rgba(56, 139, 253, 0.4);
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            margin-right: 10px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .status-badge {
            font-size: 0.8em;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 10px;
            vertical-align: middle;
        }
        .status-200 { background-color: var(--success-color); color: white; }
        .status-err { background-color: var(--danger-color); color: white; }

        /* è¡¨æ ¼æ ·å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.85em;
            table-layout: fixed;
        }
        
        th, td {
            text-align: left;
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        th { color: var(--text-secondary); width: 35%; }
        td { color: var(--text-primary); word-break: break-all; }
        
        .trace-row { background-color: rgba(210, 153, 34, 0.1); }
        .trace-key { color: var(--warning-color); font-weight: bold; }

        .hidden { display: none; }
        #error-msg { color: var(--danger-color); margin-top: 10px; }
        
        /* Loading åŠ¨ç”» */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“¡ ç½‘é¡µ CDN ç©¿é€æ£€æµ‹</h1>
    
    <div class="card">
        <div class="input-group">
            <input type="text" id="target-url" placeholder="https://example.com" />
            <button id="btn-check" onclick="startCheck()">å¼€å§‹æ£€æµ‹</button>
        </div>
        
        <div class="options">
            <label style="cursor: pointer; display: flex; align-items: center;">
                <input type="checkbox" id="use-proxy"> 
                <span style="margin-left: 6px;">å¼€å¯è·¨åŸŸä»£ç† (æ£€æµ‹å¤–éƒ¨ç½‘ç«™æ—¶å¿…é€‰)</span>
            </label>
        </div>
        <div id="error-msg"></div>
    </div>

    <!-- ç»“æœåŒºåŸŸ -->
    <div id="result-area" class="hidden">
        
        <!-- æ¦‚è§ˆ -->
        <div class="card">
            <h3 style="margin-top:0">æ£€æµ‹ç»“è®º <span id="status-code"></span></h3>
            <div id="cdn-tags">
                <!-- JS æ’å…¥å¾½ç«  -->
            </div>
            <div id="cdn-summary" style="color: var(--text-secondary); margin-top: 10px;"></div>
        </div>

        <!-- è¯¦ç»† Header -->
        <div class="card">
            <h3 style="margin-top:0">åŸå§‹å“åº”å¤´ (Headers)</h3>
            <p style="font-size: 0.8em; color: var(--text-secondary)">é»„è‰²é«˜äº®è¡Œè¡¨ç¤ºå‘½ä¸­äº†å·²çŸ¥ CDN ç‰¹å¾åº“</p>
            <table id="header-table">
                <thead>
                    <tr>
                        <th>Header Name</th>
                        <th>Header Value</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // åˆå§‹åŒ–ï¼šé»˜è®¤å¡«å…¥å½“å‰ URL
    document.getElementById('target-url').value = window.location.href;

    // CDN ç‰¹å¾åº“
    const cdnSignatures = [
        { name: "Cloudflare", check: (k, v) => v.includes('cloudflare') || k.includes('cf-ray') || k.includes('cf-cache-status') },
        { name: "Vercel", check: (k, v) => v.includes('vercel') || k.includes('x-vercel') },
        { name: "Netlify", check: (k, v) => v.includes('netlify') },
        { name: "GitHub Pages", check: (k, v) => v.includes('github.com') || v.includes('github-pages') },
        { name: "AWS CloudFront", check: (k, v) => k.includes('x-amz-cf') || (k === 'via' && v.includes('cloudfront')) },
        { name: "Akamai", check: (k, v) => k.includes('akamai') || v.includes('akamai') },
        { name: "Fastly", check: (k, v) => k.includes('fastly') || (k === 'via' && v.includes('fastly')) || k === 'x-served-by' },
        { name: "Aliyun (é˜¿é‡Œäº‘)", check: (k, v) => k.includes('eagleid') || k.includes('aliyun') },
        { name: "Tencent (è…¾è®¯äº‘)", check: (k, v) => k.includes('x-daa-tunnel') || k.includes('x-nws-log') },
        { name: "Gcore", check: (k, v) => k.includes('gcore') },
        { name: "Azion", check: (k, v) => k.includes('azion') },
        { name: "CacheFly", check: (k, v) => k.includes('cachefly') },
        { name: "Sucuri", check: (k, v) => v.includes('sucuri') || k.includes('x-sucuri') },
        { name: "Nginx", check: (k, v) => k === 'server' && v === 'nginx' } // å¯èƒ½æ˜¯é€šç”¨æœåŠ¡å™¨ï¼Œä¹Ÿå¯èƒ½æ˜¯è‡ªå»ºCDN
    ];

    async function startCheck() {
        const urlInput = document.getElementById('target-url');
        const useProxy = document.getElementById('use-proxy').checked;
        const btn = document.getElementById('btn-check');
        const errorDiv = document.getElementById('error-msg');
        const resultArea = document.getElementById('result-area');
        
        // é‡ç½® UI
        errorDiv.innerText = '';
        resultArea.classList.add('hidden');
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner"></span> æ£€æµ‹ä¸­...';

        let targetUrl = urlInput.value.trim();
        if (!targetUrl.startsWith('http')) {
            targetUrl = 'https://' + targetUrl;
            urlInput.value = targetUrl;
        }

        // åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€åŸŸå
        const isSameOrigin = targetUrl.startsWith(window.location.origin);
        
        // å¦‚æœæ£€æµ‹å¤–éƒ¨ç½‘ç«™ä¸”æ²¡å¼€ä»£ç†ï¼Œæç¤ºè­¦å‘Šï¼ˆä½†ä»å°è¯•è¯·æ±‚ï¼Œå› ä¸ºå¯èƒ½å¯¹æ–¹å¼€äº† CORSï¼‰
        if (!isSameOrigin && !useProxy) {
            console.warn("å°è¯•ç›´æ¥è®¿é—®å¤–éƒ¨ URLï¼Œå¯èƒ½ä¼šå›  CORS å¤±è´¥ã€‚");
        }

        // æ„é€ è¯·æ±‚ URL
        // æ³¨æ„ï¼šcorsproxy.io æ˜¯ä¸€ä¸ªå…¬å…±ä»£ç†ï¼Œä»…ç”¨äºæ¼”ç¤ºã€‚ç”Ÿäº§ç¯å¢ƒå»ºè®®è‡ªå»º Workerã€‚
        const fetchUrl = useProxy 
            ? `https://corsproxy.io/?${encodeURIComponent(targetUrl)}` 
            : targetUrl;

        try {
            const response = await fetch(fetchUrl, {
                method: 'GET',
                cache: 'no-cache', // å¼ºåˆ¶è·å–æœ€æ–°
                mode: 'cors'
            });

            // å¤„ç†ç»“æœ
            renderResults(response, useProxy);
            
        } catch (err) {
            let msg = err.message;
            if (msg.includes('Failed to fetch')) {
                msg = `âŒ è¯·æ±‚è¢«æ‹¦æˆª (CORS é”™è¯¯)ã€‚<br>åŸå› ï¼šç›®æ ‡ç½‘ç«™ç¦æ­¢äº†è·¨åŸŸè®¿é—®ã€‚<br><b>è§£å†³åŠæ³•ï¼šè¯·å‹¾é€‰â€œå¼€å¯è·¨åŸŸä»£ç†â€é‡è¯•ã€‚</b>`;
            }
            errorDiv.innerHTML = msg;
        } finally {
            btn.disabled = false;
            btn.innerText = 'å¼€å§‹æ£€æµ‹';
        }
    }

    function renderResults(response, usedProxy) {
        const resultArea = document.getElementById('result-area');
        const tableBody = document.querySelector('#header-table tbody');
        const cdnTagsDiv = document.getElementById('cdn-tags');
        const summaryDiv = document.getElementById('cdn-summary');
        const statusCodeSpan = document.getElementById('status-code');

        tableBody.innerHTML = '';
        cdnTagsDiv.innerHTML = '';
        
        // çŠ¶æ€ç 
        statusCodeSpan.innerHTML = `<span class="status-badge ${response.ok ? 'status-200' : 'status-err'}">${response.status} ${response.statusText}</span>`;

        const foundCDNs = new Set();
        const headersList = [];

        // æå– Header
        for (const [key, value] of response.headers.entries()) {
            headersList.push({ key, value });
            
            // æ£€æµ‹ CDN ç‰¹å¾
            cdnSignatures.forEach(sig => {
                if (sig.check(key.toLowerCase(), value.toLowerCase())) {
                    foundCDNs.add(sig.name);
                }
            });
        }
        
        // å¦‚æœä½¿ç”¨äº†ä»£ç†ï¼ŒServer å¤´é€šå¸¸ä¼šè¢«ä»£ç†è¦†ç›–ï¼Œéœ€è¦å‰”é™¤è¯¯æŠ¥
        // corsproxy.io æœ‰æ—¶ä¼šä¿ç•™åŸ server å¤´ï¼Œæœ‰æ—¶ä¸ä¼šï¼Œè¿™é‡Œç®€å•å¤„ç†ï¼š
        // å¦‚æœä½¿ç”¨äº†ä»£ç†ï¼Œä¸”æ£€æµ‹ç»“æœåªæœ‰ Cloudflareï¼ˆå› ä¸º corsproxy è·‘åœ¨ CF ä¸Šï¼‰ï¼Œæç¤ºå¯èƒ½ä¸å‡†ç¡®
        if (usedProxy && foundCDNs.has('Cloudflare') && foundCDNs.size === 1) {
            // è¿™é‡Œä¸åšç¡¬æ€§ç§»é™¤ï¼Œä½†åœ¨è¯´æ˜é‡Œæç¤º
        }

        // æ¸²æŸ“å¾½ç« 
        if (foundCDNs.size > 0) {
            foundCDNs.forEach(cdn => {
                const badge = document.createElement('span');
                badge.className = 'cdn-badge';
                badge.innerText = cdn;
                cdnTagsDiv.appendChild(badge);
            });
        } else {
            cdnTagsDiv.innerHTML = '<span style="color:#888">æœªæ£€æµ‹åˆ°çŸ¥å CDN ç‰¹å¾ï¼Œæˆ– Header è¢«æ¸…æ´—ã€‚</span>';
        }

        // æ¸²æŸ“æ€»ç»“æ–‡å­—
        if (usedProxy) {
            summaryDiv.innerHTML = "âš ï¸ <b>æ³¨æ„ï¼š</b>ä½¿ç”¨äº†ä»£ç†æ¨¡å¼ã€‚éƒ¨åˆ† Header (å¦‚ Server) å¯èƒ½æ¥è‡ªä»£ç†æœåŠ¡å™¨æœ¬èº«è€Œéç›®æ ‡æºç«™ã€‚è¯·é‡ç‚¹å…³æ³¨ X-Cache, Via ç­‰ç©¿é€æ€§å­—æ®µã€‚";
        } else {
            summaryDiv.innerHTML = "âœ… ç›´è¿æ¨¡å¼ï¼šæ£€æµ‹ç»“æœå…·æœ‰æœ€é«˜å‡†ç¡®æ€§ã€‚";
        }

        // æ¸²æŸ“è¡¨æ ¼
        headersList.sort((a, b) => a.key.localeCompare(b.key));
        headersList.forEach(h => {
            const row = document.createElement('tr');
            const k = h.key.toLowerCase();
            const v = h.value.toLowerCase();
            
            // åˆ¤æ–­æ˜¯å¦æ˜¯ç—•è¿¹
            let isTrace = cdnSignatures.some(sig => sig.check(k, v));
            
            if (isTrace) {
                row.className = 'trace-row';
                row.innerHTML = `<td class="trace-key">${h.key}</td><td>${h.value}</td>`;
            } else {
                row.innerHTML = `<td>${h.key}</td><td>${h.value}</td>`;
            }
            tableBody.appendChild(row);
        });

        resultArea.classList.remove('hidden');
    }
</script>

</body>
</html>
